# Day_7

## 전역 변수와 메모리: 전역 변수 쓰지 말라니까요!

두 메서드 사이에 값을 전달하는 방법은 메서드를 호출할 때 메서드의 인자를 이용하는 방법과 메서드를 종료할 때 반환 값을 넘겨주는 방법이 있다고 했다. 그런데 메서드 사이에 값을 공유하는 방법이 사실 하나 더 있다. 바로 전역 변수를 사용하는 것이다. 밑에 코드와 사진을 살펴보자

```java
public class Start5 {
    static int share;

    private static int fun(int m, int p) {
        share = m + p;

        return m - p;
    }

    public static void main(String[] args) {
        share = 55;

        int k = fun(5, 7);

        System.out.println(k);
        System.out.println(share);
    }
}
```

<img src="/static/2-33.PNG" width="513px" height="349px"></img>

코드를 보면 share 변수에 static 키워드가 붙어있다. 그래서 share변수는 T 메모리의 스태틱 영역에 변수 공간이 할당된다. 그것도 Start5 클래스 안에 정의됐으니 해당 클래스가 T 메모리 스태틱 영역에 배치될 때 그 안에 share변수가 클래스의 멤버로 공간을 만들어 저장된다. 

share = 55 줄을 실행하고 나면 T 메모리에 main() 메서드 스택 프레임이 만들어진다. 그리고 그 밑에 줄을 실행하면 다음과 같을 것이다.

<img src="/static/2-34.PNG" width="513px" height="349px"></img>

int k = fun(5, 7) 줄을 가면 메서드 스택 프레임에 k 변수 공간이 만들어지고 제어는 fun() 메서드가 있는 줄로 넘어간다. 그러면서 fun 메서드 스택 프레임이 생성되고 인자 값들과 반환 값을 저장할 변수 공간도 생긴다.

<img src="/static/2-35.PNG" width="513px" height="349px"></img>

그 다음 진행되고 나면 m변수와 p 변수에 있는 값을 더해 share 변수에 할당한 상태가 된다.

<img src="/static/2-36.PNG" width="513px" height="349px"></img>

그 후에 최종적으로 m - p 값은 - 2를 반환하게 되고 닫는 중괄호를 만나 fun메서드는 끝나게 된다.

그리고 다시 fun메서드를 호출했던 곳으로 이동하게 된다.

<img src="/static/2-39.PNG" width="513px" height="349px"></img>

그리고 마지막 값을 출력한 뒤에 main() 메서드 스택 프레임이 사라지고 사용했던 T메모리도 반납 된다. 코드를 보면 메서드 밖에서 선언된 변수 share는 메서드들 사이에서 공유해서 사용할 수 있는 전역 변수가 된다. 앞에서 배운 두 가지 변수 유형을 기억하자. 바로 지역 변수와 전역 변수다. 각각 특징은 다음과 같다. 

- 스택 프레임에 종속된 지역 변수
- 스택 프레임에 독립적인 전역 변수

전역 변수는 코드 어느 곳에 서나 접근할 수 있다고 해서 전역 변수라고 하며, 여러 메서드들이 공유해서 사용한다고 해서 공유 변수라고도 한다 그런데 전역 변수를 쓰지 말라고 하는데 왜 그럴까 생각해보자 프로젝트 규모가 따라 코드가 커지면서 여러 메서드에서 전역 변수의 값을 변경하기 시작하면 T 메모리로 추적하지 않는 이상 전역 변수에 저장돼 있는 값을 파악하기 쉽지 않기 때문이다. 방금 전 살펴본 코드에서도 main() 메서드에서는 share 변수에 55를 저장했으니 그 값이 55라고 착각할 수 있다.

이를 추적하고 그 값과 그 값이 변한 이유를 파악하려면 아주 어렵고 힘든 작업이 될 것이다.

결론 적으로 전역 변수는 피할 수 있다면 무조건 피해야 한다. 다만 읽기 전용으로 값을 공유 해서 전역 상수로 쓰는 것을 적극 추천한다. 가장 대표적인 전역 상수 후보로는 원주율을 나타는 PI 값등이 있다.

멀티 스레드 프로그램을 학습한 경험이 있다면 전역 변수가 어떤 문제를 일으키는지 알 것이다.