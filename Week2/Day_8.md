# Day_8

## 멀티 스레드/ 멀티 프로세스의 이해

멀티 스레드의 T 메모리 모델은 스택 영역을 스레드 개수만큼 분할해서 쓰는 것이다.

<img src="/static/2-40.PNG" width="575" height="195"></img>

멀티 프로세스는 다수의 데이터 저장 영역, 즉 다수의 T 메모리를 갖는 구조이다.

<img src="/static/2-41.PNG" width="575" height="195"></img>

멀티 프로세스는 각 프로세스마다 각자의 T 메모리가 있고 각자 고유의 공간이므로 서로 참조할 수 없다. 그에 반해 멀티 스레드는 하나의 T 메모리만 사용하는데 스택 영역만 분할해서 사용하는 구조다. 

멀티 프로세스는 각 프로세스마다 각자의 T 메모리가 있고 각자 고유이므로 서로 참조할 수 없다. 그에 반해 멀티 스레드는 하나의 T 메모리만 사용하는데 스택 영역만 분할해서 사용하는 구조다.

멀티 프로세스는 하나의 프로세스가 다른 프로세스의 T 메모리 영역을 절대 침범할 수 없는 메모리 안전한 구조이지만 메모리 사용량은 그만큼 크다.

멀티 스레드는 하나의 T 메모리 안에서 스택 영역만 분할한 것이기 때문에 하나의 스레드에서 스레드의 스택 영역에는 접근할 수 없지만 스태틱 영역과 힙 영역은 공유해서 사용하는 구조다. 따라서 멀티 프로세스 대비 메모리를 적게 사용할 수 있는 구조다.

자바 웹 프로그래밍을 공부해 본 적이 있다면 서블릿은 요청 당 프로세스가 아닌 요청 당 스레드를 생성 한다는 말이 머릿속 어딘가 에 콕 박혀 있을 것이다. 이제는 요청 당 스레드(Servlet)가 요청 당 프로세스(CGI)보다 왜 더 효율적인지 이해할 수 있을 것이다.

멀티 스레드에서 전역 변수 사용의 문제점을 살펴보자. 두 개의 스레드로 구성딘 프로그램이 있다고 해보자. 스레드1이 공유 영역(스태틱 과 힙)에 있는 전역변수  A에 10을 할당했다고 해보자. 그런데 CPU 사용권이 스레드2로 넘어가고 스레드2가 전역 변수 A에 20을 할당하고 다시 CPU 사용권이 스레드1로 넘어가서 A의 값을 출력해 보면 어떻게 될까? 스레드1의 입장에서는 갑자기 20이라는 값이 출력되는 문제가 발생한다.

[제목 없음](https://www.notion.so/990247631c4b4931a3696c53d1704fcb)

바로 위의 절에서 전역 변수를 쓰지 말라는 말이 기억날 것이다. 쓰기 가능한 전역 변수를 사용하게 되면 스레드 안전성이 깨진다고 표현한다. 물론 이를 보완하는 방법으로 락(lock)을 거는 방법이 있기는 하다. 하지만 락을 거는 순간 멀티 스레드의 장점은 버린 것과 같다. 갑자기 수준이 깊어졌는데 더 깊은 내용은 중 고급 서적을 통해 학습하기 바란다.

멀티 스레드는 웹 프로그래밍에서 참 열심히 쓰는 기술이다. 따라서 멀티 스레드의 속성을 모르면 웹 프로그램을 작성할 때 낭패를 보게 되는 경우가 많다. 아래의 코드를 살펴보자

```java
public class Start6 extends Thread {
    static int share;

    public void run() {
        for(int count = 0; count < 10; count ++) {
            System.out.println(share ++);

            try {
                sleep(1000);
            } catch(InterruptedException e) {
                e.printStackTrace();
            }
        }
    }

    public static void main(String[] args) {
        Start6 t1 = new Start6();
        Start6 t2 = new Start6();

        t1.start();
        t2.start();
    }
}
```